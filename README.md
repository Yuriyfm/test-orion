# test-orion 
REST API сервер «Адресная книга».

## О приложении
  Приложение представляет собой REST API сервер «Адресная книга» с реализацией полноценного CRUD по всем сущностям, с возможностью автоматического развертывания структуры БД, и
  автозаполнения БД искуственно сгенерированными данными, а также валидацией принимаемых через API данных по всем полям с помощью regexp (тип валидации определяется исходя из
  контекста поля). 
  Приложение написано на flask и использованием дополнительных библиотек. Все зависимости указаны в файле requirements.txt в корневом каталоге. БД - PostgreSQL. Фронтэнд не 
  предусмотрен. 
  
## Описание структуры БД
Сущности: 

    • Пользователи (таблица persons)

    • Телефоны (таблица phones)

    • Электронные адреса (таблица emails)

 ### Атрибуты сущностей с названиями колонок и ограничениями по ключам:
Пользователи:

    •	ID пользователя - person_id (primary key)

    •	ФИО - full_name

    •	Путь к файлу аватара на сервере - file_path

    •	Пол - gender

    •	Дата рождения - birthday

    •	Адрес проживания - address

Телефоны:

    •	ID пользователя - person_id (foreign key)

    •	Вид (Городской/Мобильный) - phone_type

    •	Номер телефона - phone_number (primary key)

Электронные адреса:

    •	ID пользователя - person_id (foreign key)

    •	Вид (Личная/Рабочая) - email_type

    •	Email - email_address (primary key)


  ## Запуск
  Перед первым запуском необходимо создать новую БД и развернуть структуру таблиц. Для этого:
  
    • Укажите параметры подключения к БД в файле orion/config.ini

    • В командной строке выполните команду, для cmd -  set FLASK_APP=orion, для bash - export FLASK_APP=orion

    • Запустите в python файл  utils/create_db.py - который создаст новую БД по указанным параметрам подключения

    • Выполните миграции командами - flask db migrate -->  flask db upgrade 


    • Запустите файл runsernver.py. Приложение будет доступно по адресу http://127.0.0.1:5000/


  ## описание API 
  API работает с запросами содержащими в теле данные в формате JSON.
  
  ***Примеры данных JSON для маршрутов (также JSON объекты для тестирования можно сгенерировать в модуле data_generator.py) - в файле JSON_examples.txt***
  
Маршруты, типы запросов и краткое описание:

    получение данных (тип запроса POST):

      /api/get_persons_list - возвращает все записи таблицы persons. Принимает на вход данные для сортировки по любому из атрибутов сущности

      /api/get_person - возвращает конкретную запись таблицы person. Принимает на вход person_id

      /api/get_phones_list - возвращает все записи таблицы phones. Принимает на вход данные для сортировки по любому из атрибутов сущности

      /api/get_phone - возвращает конкретную запись таблицы phone. Принимает на вход person_id

      /api/get_emails_list - возвращает все записи таблицы emails. Принимает на вход данные для сортировки по любому из атрибутов сущности

      /api/get_email -  возвращает конкретную запись таблицы emails. Принимает на вход person_id


    добавление данных (тип запроса PUT):

      /api/add_person - тип запроса PUT, добавляет данные одного или нескольких контактов в таблицу persons и связанные таблицы

      /api/add_phone - тип запроса PUT, добавляет данные в таблицу phone. Принимает на вход person_id, phone_number (должен быть уникальным) и phone_type 

      /api/add_email - тип запроса PUT, добавляет данные в таблицу email. Принимает на вход person_id, email_address (должен быть уникальным)  и email_type


    Изменение данных (тип запроса PATCH):

      /api/update_person - тип запроса PATCH, изменяет запись в таблице persons. Принимает на вход person_id

      /api/update_phone - тип запроса PATCH, изменяет запись в таблице phones. Принимает на вход person_id, phone_number (должен быть уникальным) и phone_type

      /api/update_email - тип запроса PATCH, изменяет запись в таблице emails. Принимает на вход person_id, email_address (должен быть уникальным)  и email_type

      /api/delete_person - тип запроса DELETE, удаляет запись в таблице persons и в связанных таблицах. Принимает на вход person_id


    Удаление данных (тип запроса DELETE): 

      /api/delete_phone - тип запроса DELETE, удаляет запись в таблице phones. Принимает на вход person_id

      /api/get_email - тип запроса POST, возвращает конкретную запись таблицы emails. Принимает на вход person_id

      /api/delete_email - тип запроса DELETE, удаляет запись в таблице emails. Принимает на вход person_id


## Основные модули:

    • orion/__init__.py - модуль с приложением flask и подключением к БД SQLAlchemy и flask_migrate

    • orion/api/handlers.py - модуль с обработчиками запросов к API

    • orion/config.ini - модуль хранит данные для подключения к БД

    • orion/data_validation.py - модуль с функциями для валидации данных с помощью regexp

    • orion/models.py - модуль с классами моделей таблиц в БД и их методы для обработки данных

    • utils/create_db.py - модуль для создания новой БД

    • utils/data_generator.py - модуль генерации данных для БД

    • utils/upload_data.py - файл для наполнения базы данными из data_generator
    
    • runserver.py - модуль для запуска приложения






  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
